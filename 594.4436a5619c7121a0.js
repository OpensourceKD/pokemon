(self.webpackChunkpokemon=self.webpackChunkpokemon||[]).push([[594,213],{1213:(E,l,r)=>{r.r(l),r.d(l,{AuthService:()=>p,CoreServicesComponent:()=>m,CoreServicesService:()=>a});var n=r(4332);let a=(()=>{class h{constructor(){}static{this.\u0275fac=function(e){return new(e||h)}}static{this.\u0275prov=n.\u0275\u0275defineInjectable({token:h,factory:h.\u0275fac,providedIn:"root"})}}return h})();var d=r(467),i=r(4412),u=r(4230);let p=(()=>{class h{constructor(t){this.http=t,this.id="auth of pokemon",this.ISSUER_BASE_URL="https://topfix-wrczmn.us1.zitadel.cloud",this.CLIENT_ID="336777344075263315",this.REDIRECT_URI="https://opensourcekd.github.io/pokemon/#/auth-callback",this.SCOPE="openid profile email",this.TOKEN_KEY="zitadel_token",this.USER_INFO_KEY="zitadel_user_info",this.userSubject=new i.t(this.getUserInfoFromStorage()),this.user$=this.userSubject.asObservable(),console.log("In constructor of auth service in pokemon")}login(t){t&&console.log(`[AuthService] Logged in: ${t}`),this.redirectToZitadelLogin()}redirectToZitadelLogin(){const t=new URL(`${this.ISSUER_BASE_URL}/oauth/v2/authorize`),e=this.generateRandomState(),s=this.generateCodeVerifier();sessionStorage.setItem("oauth_state",e),sessionStorage.setItem("code_verifier",s),t.searchParams.append("client_id",this.CLIENT_ID),t.searchParams.append("redirect_uri",this.REDIRECT_URI),t.searchParams.append("response_type","code"),t.searchParams.append("scope",this.SCOPE),t.searchParams.append("state",e),window.location.href=t.toString()}handleCallback(t,e){var s=this;return(0,d.A)(function*(){const v=sessionStorage.getItem("oauth_state");if(e!==v)return console.error("State mismatch - possible CSRF attack"),!1;try{const o=yield s.exchangeCodeForToken(t);s.setToken(o.access_token);const b=s.decodeIdToken(o.id_token);return s.setUserInfo(b),sessionStorage.removeItem("oauth_state"),sessionStorage.removeItem("code_verifier"),!0}catch(o){return console.error("Error exchanging code for token:",o),!1}})()}exchangeCodeForToken(t){var e=this;return(0,d.A)(function*(){const s=`${e.ISSUER_BASE_URL}/oauth/v2/token`,v=new URLSearchParams({grant_type:"authorization_code",code:t,redirect_uri:e.REDIRECT_URI,client_id:e.CLIENT_ID}),o=yield fetch(s,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:v.toString()});if(!o.ok)throw new Error(`Token exchange failed: ${o.statusText}`);return o.json()})()}decodeIdToken(t){try{const e=t.split(".")[1],s=JSON.parse(atob(e));return{sub:s.sub,name:s.name,email:s.email}}catch(e){return console.error("Error decoding ID token:",e),{sub:""}}}logout(){localStorage.removeItem(this.TOKEN_KEY),localStorage.removeItem(this.USER_INFO_KEY),this.userSubject.next(null)}getToken(){return localStorage.getItem(this.TOKEN_KEY)}setToken(t){localStorage.setItem(this.TOKEN_KEY,t)}isAuthenticated(){return!!this.getToken()}getUser(){return this.userSubject.value}getUserInfoFromStorage(){const t=localStorage.getItem(this.USER_INFO_KEY);return t?JSON.parse(t):null}setUserInfo(t){localStorage.setItem(this.USER_INFO_KEY,JSON.stringify(t)),this.userSubject.next(t)}generateRandomState(){const t=new Uint8Array(32);return crypto.getRandomValues(t),Array.from(t,e=>e.toString(16).padStart(2,"0")).join("")}generateCodeVerifier(){const t=new Uint8Array(32);return crypto.getRandomValues(t),Array.from(t,e=>e.toString(16).padStart(2,"0")).join("")}static{this.\u0275fac=function(e){return new(e||h)(n.\u0275\u0275inject(u.HttpClient))}}static{this.\u0275prov=n.\u0275\u0275defineInjectable({token:h,factory:h.\u0275fac,providedIn:"root"})}}return h})(),m=(()=>{class h{static{this.\u0275fac=function(e){return new(e||h)}}static{this.\u0275cmp=n.\u0275\u0275defineComponent({type:h,selectors:[["org-core-services"]],standalone:!0,features:[n.\u0275\u0275StandaloneFeature],decls:2,vars:0,template:function(e,s){1&e&&(n.\u0275\u0275elementStart(0,"p"),n.\u0275\u0275text(1," core-services works! "),n.\u0275\u0275elementEnd())}})}}return h})()},4412:(E,l,r)=>{r.d(l,{t:()=>a});var n=r(3794);class a extends n.B{constructor(i){super(),this._value=i}get value(){return this.getValue()}_subscribe(i){const u=super._subscribe(i);return!u.closed&&i.next(this._value),u}getValue(){const{hasError:i,thrownError:u,_value:p}=this;if(i)throw u;return this._throwIfClosed(),p}next(i){super.next(this._value=i)}}},1985:(E,l,r)=>{r.d(l,{c:()=>h});var n=r(7707),a=r(8359),d=r(3494),i=r(1203),u=r(1026),p=r(8071),m=r(9786);let h=(()=>{class s{constructor(o){o&&(this._subscribe=o)}lift(o){const b=new s;return b.source=this,b.operator=o,b}subscribe(o,b,I){const g=function e(s){return s&&s instanceof n.vU||function t(s){return s&&(0,p.T)(s.next)&&(0,p.T)(s.error)&&(0,p.T)(s.complete)}(s)&&(0,a.Uv)(s)}(o)?o:new n.Ms(o,b,I);return(0,m.Y)(()=>{const{operator:y,source:U}=this;g.add(y?y.call(g,U):U?this._subscribe(g):this._trySubscribe(g))}),g}_trySubscribe(o){try{return this._subscribe(o)}catch(b){o.error(b)}}forEach(o,b){return new(b=f(b))((I,g)=>{const y=new n.Ms({next:U=>{try{o(U)}catch(O){g(O),y.unsubscribe()}},error:g,complete:I});this.subscribe(y)})}_subscribe(o){var b;return null===(b=this.source)||void 0===b?void 0:b.subscribe(o)}[d.s](){return this}pipe(...o){return(0,i.m)(o)(this)}toPromise(o){return new(o=f(o))((b,I)=>{let g;this.subscribe(y=>g=y,y=>I(y),()=>b(g))})}}return s.create=v=>new s(v),s})();function f(s){var v;return null!==(v=s??u.$.Promise)&&void 0!==v?v:Promise}},3794:(E,l,r)=>{r.d(l,{B:()=>m});var n=r(1985),a=r(8359);const i=(0,r(1853).L)(f=>function(){f(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});var u=r(7908),p=r(9786);let m=(()=>{class f extends n.c{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(e){const s=new h(this,this);return s.operator=e,s}_throwIfClosed(){if(this.closed)throw new i}next(e){(0,p.Y)(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const s of this.currentObservers)s.next(e)}})}error(e){(0,p.Y)(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=e;const{observers:s}=this;for(;s.length;)s.shift().error(e)}})}complete(){(0,p.Y)(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:e}=this;for(;e.length;)e.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var e;return(null===(e=this.observers)||void 0===e?void 0:e.length)>0}_trySubscribe(e){return this._throwIfClosed(),super._trySubscribe(e)}_subscribe(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)}_innerSubscribe(e){const{hasError:s,isStopped:v,observers:o}=this;return s||v?a.Kn:(this.currentObservers=null,o.push(e),new a.yU(()=>{this.currentObservers=null,(0,u.o)(o,e)}))}_checkFinalizedStatuses(e){const{hasError:s,thrownError:v,isStopped:o}=this;s?e.error(v):o&&e.complete()}asObservable(){const e=new n.c;return e.source=this,e}}return f.create=(t,e)=>new h(t,e),f})();class h extends m{constructor(t,e){super(),this.destination=t,this.source=e}next(t){var e,s;null===(s=null===(e=this.destination)||void 0===e?void 0:e.next)||void 0===s||s.call(e,t)}error(t){var e,s;null===(s=null===(e=this.destination)||void 0===e?void 0:e.error)||void 0===s||s.call(e,t)}complete(){var t,e;null===(e=null===(t=this.destination)||void 0===t?void 0:t.complete)||void 0===e||e.call(t)}_subscribe(t){var e,s;return null!==(s=null===(e=this.source)||void 0===e?void 0:e.subscribe(t))&&void 0!==s?s:a.Kn}}},7707:(E,l,r)=>{r.d(l,{Ms:()=>I,vU:()=>s});var n=r(8071),a=r(8359),d=r(1026),i=r(5334),u=r(5343);const p=f("C",void 0,void 0);function f(S,c,_){return{kind:S,value:c,error:_}}var t=r(9270),e=r(9786);class s extends a.yU{constructor(c){super(),this.isStopped=!1,c?(this.destination=c,(0,a.Uv)(c)&&c.add(this)):this.destination=O}static create(c,_,T){return new I(c,_,T)}next(c){this.isStopped?U(function h(S){return f("N",S,void 0)}(c),this):this._next(c)}error(c){this.isStopped?U(function m(S){return f("E",void 0,S)}(c),this):(this.isStopped=!0,this._error(c))}complete(){this.isStopped?U(p,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(c){this.destination.next(c)}_error(c){try{this.destination.error(c)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const v=Function.prototype.bind;function o(S,c){return v.call(S,c)}class b{constructor(c){this.partialObserver=c}next(c){const{partialObserver:_}=this;if(_.next)try{_.next(c)}catch(T){g(T)}}error(c){const{partialObserver:_}=this;if(_.error)try{_.error(c)}catch(T){g(T)}else g(c)}complete(){const{partialObserver:c}=this;if(c.complete)try{c.complete()}catch(_){g(_)}}}class I extends s{constructor(c,_,T){let C;if(super(),(0,n.T)(c)||!c)C={next:c??void 0,error:_??void 0,complete:T??void 0};else{let P;this&&d.$.useDeprecatedNextContext?(P=Object.create(c),P.unsubscribe=()=>this.unsubscribe(),C={next:c.next&&o(c.next,P),error:c.error&&o(c.error,P),complete:c.complete&&o(c.complete,P)}):C=c}this.destination=new b(C)}}function g(S){d.$.useDeprecatedSynchronousErrorHandling?(0,e.l)(S):(0,i.m)(S)}function U(S,c){const{onStoppedNotification:_}=d.$;_&&t.f.setTimeout(()=>_(S,c))}const O={closed:!0,next:u.l,error:function y(S){throw S},complete:u.l}},8359:(E,l,r)=>{r.d(l,{Kn:()=>p,yU:()=>u,Uv:()=>m});var n=r(8071);const d=(0,r(1853).L)(f=>function(e){f(this),this.message=e?`${e.length} errors occurred during unsubscription:\n${e.map((s,v)=>`${v+1}) ${s.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=e});var i=r(7908);class u{constructor(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let t;if(!this.closed){this.closed=!0;const{_parentage:e}=this;if(e)if(this._parentage=null,Array.isArray(e))for(const o of e)o.remove(this);else e.remove(this);const{initialTeardown:s}=this;if((0,n.T)(s))try{s()}catch(o){t=o instanceof d?o.errors:[o]}const{_finalizers:v}=this;if(v){this._finalizers=null;for(const o of v)try{h(o)}catch(b){t=t??[],b instanceof d?t=[...t,...b.errors]:t.push(b)}}if(t)throw new d(t)}}add(t){var e;if(t&&t!==this)if(this.closed)h(t);else{if(t instanceof u){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=null!==(e=this._finalizers)&&void 0!==e?e:[]).push(t)}}_hasParent(t){const{_parentage:e}=this;return e===t||Array.isArray(e)&&e.includes(t)}_addParent(t){const{_parentage:e}=this;this._parentage=Array.isArray(e)?(e.push(t),e):e?[e,t]:t}_removeParent(t){const{_parentage:e}=this;e===t?this._parentage=null:Array.isArray(e)&&(0,i.o)(e,t)}remove(t){const{_finalizers:e}=this;e&&(0,i.o)(e,t),t instanceof u&&t._removeParent(this)}}u.EMPTY=(()=>{const f=new u;return f.closed=!0,f})();const p=u.EMPTY;function m(f){return f instanceof u||f&&"closed"in f&&(0,n.T)(f.remove)&&(0,n.T)(f.add)&&(0,n.T)(f.unsubscribe)}function h(f){(0,n.T)(f)?f():f.unsubscribe()}},1026:(E,l,r)=>{r.d(l,{$:()=>n});const n={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1}},9270:(E,l,r)=>{r.d(l,{f:()=>n});const n={setTimeout(a,d,...i){const{delegate:u}=n;return u?.setTimeout?u.setTimeout(a,d,...i):setTimeout(a,d,...i)},clearTimeout(a){const{delegate:d}=n;return(d?.clearTimeout||clearTimeout)(a)},delegate:void 0}},3494:(E,l,r)=>{r.d(l,{s:()=>n});const n="function"==typeof Symbol&&Symbol.observable||"@@observable"},7908:(E,l,r)=>{function n(a,d){if(a){const i=a.indexOf(d);0<=i&&a.splice(i,1)}}r.d(l,{o:()=>n})},1853:(E,l,r)=>{function n(a){const i=a(u=>{Error.call(u),u.stack=(new Error).stack});return i.prototype=Object.create(Error.prototype),i.prototype.constructor=i,i}r.d(l,{L:()=>n})},9786:(E,l,r)=>{r.d(l,{Y:()=>d,l:()=>i});var n=r(1026);let a=null;function d(u){if(n.$.useDeprecatedSynchronousErrorHandling){const p=!a;if(p&&(a={errorThrown:!1,error:null}),u(),p){const{errorThrown:m,error:h}=a;if(a=null,m)throw h}}else u()}function i(u){n.$.useDeprecatedSynchronousErrorHandling&&a&&(a.errorThrown=!0,a.error=u)}},3669:(E,l,r)=>{function n(a){return a}r.d(l,{D:()=>n})},8071:(E,l,r)=>{function n(a){return"function"==typeof a}r.d(l,{T:()=>n})},5343:(E,l,r)=>{function n(){}r.d(l,{l:()=>n})},1203:(E,l,r)=>{r.d(l,{F:()=>a,m:()=>d});var n=r(3669);function a(...i){return d(i)}function d(i){return 0===i.length?n.D:1===i.length?i[0]:function(p){return i.reduce((m,h)=>h(m),p)}}},5334:(E,l,r)=>{r.d(l,{m:()=>d});var n=r(1026),a=r(9270);function d(i){a.f.setTimeout(()=>{const{onUnhandledError:u}=n.$;if(!u)throw i;u(i)})}},467:(E,l,r)=>{function n(d,i,u,p,m,h,f){try{var t=d[h](f),e=t.value}catch(s){return void u(s)}t.done?i(e):Promise.resolve(e).then(p,m)}function a(d){return function(){var i=this,u=arguments;return new Promise(function(p,m){var h=d.apply(i,u);function f(e){n(h,p,m,f,t,"next",e)}function t(e){n(h,p,m,f,t,"throw",e)}f(void 0)})}}r.d(l,{A:()=>a})}}]);